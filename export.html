<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' data: gap: https://* http://*; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src *;">
    <title>Daily Statement</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }

    .container {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 10px;
        text-align: center;
        width: 90%;
        max-width: 400px;
        z-index: 9;
        margin-top: 35%;
        position: relative;
    }

    h1 {
        margin-bottom: 2px;
        color: #333;
        font-size: 1.5rem;
    }

    #dateTime {
        margin-bottom: 10px;
        margin-top: 10px;
        color: #666;
        font-size: 1rem;
    }

    table {
        margin-top: 15px;
        width: 100%;
        border-collapse: collapse;
    }

    table, th, td {
        border: 1px solid #0a0909;
    }

    th {
        width: 45%;
        padding: 10px;
        text-align: left;
        background-color: #f2f2f2;
    }

    td {
        width: 55%;
        padding: 10px;
        text-align: right;
    }

    #shareButtons {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    #shareWhatsApp {
        padding: 10px 15px;
        font-size: 0.875rem;
        border-radius: 5px;
        cursor: pointer;
        background-color: #25d366;
        color: white;
        align-items: center;
    }

    #shareWhatsApp:hover {
        background-color: #1ebea5;
    }

    .bird {
        background-image: url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/174479/bird-cells-new.svg");
        filter: invert(34%) sepia(55%) saturate(427%) hue-rotate(141deg) brightness(93%) contrast(91%);
        background-size: auto 100%;
        width: 88px;
        height: 125px;
        animation-name: fly-cycle;
        animation-timing-function: steps(10);
        animation-iteration-count: infinite;
    }

    .bird-one { animation-duration: 1s; animation-delay: -0.5s; }
    .bird-two { animation-duration: 0.9s; animation-delay: -0.75s; }
    .bird-three { animation-duration: 1.25s; animation-delay: -0.25s; }
    .bird-four { animation-duration: 1.1s; animation-delay: -0.5s; }

    .bird-container {
        position: absolute;
        top: 10%;
        left: -3%;
        transform: scale(0) translateX(-10vw);
        animation-name: fly-right-one;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
    }

    .bird-container-one { animation-duration: 15s; }
    .bird-container-two { animation-duration: 16s; animation-delay: 1s; }
    .bird-container-three { animation-duration: 14.6s; animation-delay: 9.5s; }
    .bird-container-four { animation-duration: 16s; animation-delay: 10.25s; }

    @keyframes fly-cycle { 100% { background-position: -900px 0; } }

    @keyframes fly-right-one {
        0% { transform: scale(0.3) translateX(-10vw); }
        10% { transform: translateY(2vh) translateX(10vw) scale(0.4); }
        20% { transform: translateY(0) translateX(30vw) scale(0.5); }
        30% { transform: translateY(4vh) translateX(50vw) scale(0.6); }
        40% { transform: translateY(2vh) translateX(70vw) scale(0.6); }
        50% { transform: translateY(0) translateX(90vw) scale(0.6); }
        60% { transform: translateY(0) translateX(110vw) scale(0.6); }
        100% { transform: translateY(0) translateX(110vw) scale(0.6); }
    }

    .header {
        position: relative;
        text-align: center;
        background: linear-gradient(109.6deg, rgba(156, 252, 248, 1) 11.2%, rgba(110, 123, 251, 1) 91.1%);
    }

    .inner-header {
        height: 83vh;
        width: 100%;
        position: relative;
    }

    #fadeDiv { opacity: 0; transform: translateX(-200px); transition: 1s; }
    #fadeDiv.show { opacity: 1; transform: translateX(0); }

    #noDataCard {
        display: none;
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        border-radius: 10px;
        padding: 20px;
        margin-top: 15px;
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        min-height: 150px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    #noDataCard i { font-size: 2em; margin-bottom: 10px; }
</style>

<body>

<script>
function showCustomMessage(msg, type = 'error') {
    console.log(`[${type.toUpperCase()}] ${msg}`);
}
</script>

<div class="header">
    <div class="inner-header flex">

        <!-- MOVED LOADING SPINNER HERE -->
        <div id="loadingCard" style="
            display:flex;
            background:#d1ecf1;
            color:#0c5460;
            border:1px solid #bee5eb;
            border-radius:10px;
            padding:20px;
            margin:20px auto;
            text-align:center;
            font-size:1.2em;
            font-weight:bold;
            width:90%;
            max-width:400px;
            min-height:150px;
            justify-content:center;
            align-items:center;
            flex-direction:column;
            z-index:99999;
        ">
            <i class="fas fa-spinner fa-spin" style="font-size:2em;margin-bottom:10px;"></i>
            Loading Dataâ€¦
        </div>

        <!-- Birds -->
        <div class="bird-container bird-container-one"><div class="bird bird-one"></div></div>
        <div class="bird-container bird-container-two"><div class="bird bird-two"></div></div>
        <div class="bird-container bird-container-three"><div class="bird bird-three"></div></div>
        <div class="bird-container bird-container-four"><div class="bird bird-four"></div></div>

        <div class="container fade-in-left" id="fadeDiv">
            <img src="blpa_logo.png" class="logo" alt="logo" id="logo" onclick="toggleRotation()" />

            <div class="container-content">
                <h1>Akhaura Land Port</h1>
                <p>Today's Statement</p>
                <p id="dateTime"></p>
            </div>

            <div id="noDataCard">
                <i class="fas fa-exclamation-triangle"></i>
                No Data Submitted Today
            </div>

            <table id="resultTable" style="display: none">
                <tr><th>Total Trucks</th><td id="totaltruck" style="text-align:center"></td></tr>
                <tr><th>Entry Fees</th><td id="entryfee"></td></tr>
                <tr id="haltageRow"><th>Haltage Fees</th><td id="haltagefee"></td></tr>
                <tr><th>Wgt. Charges</th><td id="weightfee"></td></tr>
                <tr><th>Port Charges</th><td id="portcharge"></td></tr>
                <tr><th>VAT (15%)</th><td id="vat"></td></tr>
                <tr><th>Total Revenue</th><td id="revenue"></td></tr>
            </table>

            <div id="shareButtons">
                <button id="copyStatementButton" style="display:none;">
                    <i class="fas fa-copy"></i> Copy Statement
                </button>
            </div>
        </div>
    </div>

    <div>
        <svg class="waves" xmlns="http://www.w3.org/2000/svg" viewBox="0 24 150 28" preserveAspectRatio="none">
            <defs>
                <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
            </defs>
            <g class="parallax">
                <use href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7)" />
                <use href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
                <use href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
                <use href="#gentle-wave" x="48" y="7" fill="#fff" />
            </g>
        </svg>
    </div>
</div>

<script>
function formatDateTime() {
    const now = new Date();
    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const d = `${days[now.getDay()]} ${String(now.getDate()).padStart(2,"0")} ${months[now.getMonth()]} ${now.getFullYear()}`;
    let h = now.getHours(), m = String(now.getMinutes()).padStart(2,"0"), s = String(now.getSeconds()).padStart(2,"0");
    const ampm = h>=12?"PM":"AM";
    h = h%12 || 12;
    return `${d}, ${h}:${m}:${s} ${ampm}`;
}

document.getElementById("dateTime").innerText = formatDateTime();
setInterval(() => {
    document.getElementById("dateTime").innerText = formatDateTime();
}, 1000);

function toggleRotation() {
    document.getElementById("logo").classList.toggle("rotate");
}

window.addEventListener("load", () => {
    document.getElementById("fadeDiv").classList.add("show");
});

// Helper
function roundUpToTwoDecimalPlaces(n){return Math.round(n * 100) / 100;}

// Copy
function copyStatement(num1, num2, num3, formattedRevenue, totalTruck) {
    const text = `Trucks: ${num1} Small + ${num2} Big = ${totalTruck}, Haltage Days = ${num3}, Total Revenue: ${formattedRevenue}/-`;
    const t = document.createElement("textarea");
    t.value = text; document.body.appendChild(t); t.select();
    try { document.execCommand("copy"); } catch {}
    document.body.removeChild(t);
}

// Calc
function calculateAndDisplayResults(num1, num2, num3, selectedDate) {
    const resultTable=document.getElementById("resultTable");
    const noDataCard=document.getElementById("noDataCard");
    const copyButton=document.getElementById("copyStatementButton");

    const isNoData = (num1===0 && num2===0 && num3===0);
    if(isNoData){
        resultTable.style.display="none";
        noDataCard.style.display="flex";
        copyButton.style.display="none";
        return;
    }

    resultTable.style.display="table";
    noDataCard.style.display="none";
    copyButton.style.display="inline-block";

    const SMALL=73.17, BIG=146.27, HOL=190.17, WGT=146.34, VAT=0.15;
    const totalTruck=num1+num2;

    const entry=roundUpToTwoDecimalPlaces(num1*SMALL + num2*BIG);
    const holtage=roundUpToTwoDecimalPlaces(num3*HOL);
    const weight=roundUpToTwoDecimalPlaces(totalTruck*WGT);
    const port=roundUpToTwoDecimalPlaces(entry+holtage+weight);
    const vatAmt=roundUpToTwoDecimalPlaces(port*VAT);
    const revenue=roundUpToTwoDecimalPlaces(port+vatAmt);

    document.getElementById("weightfee").innerText=`${weight}/-`;
    document.getElementById("portcharge").innerText=`${port}/-`;
    document.getElementById("vat").innerText=`${vatAmt}/-`;
    document.getElementById("revenue").innerText=`${revenue}/-`;

    if(num3===0){
        document.getElementById("haltageRow").style.display="none";
    } else {
        document.getElementById("haltageRow").style.display="table-row";
        document.getElementById("haltagefee").innerText=`${holtage}/-`;
    }

    document.getElementById("totaltruck").innerText=
        num1===0?`${num2} Big Trucks`:
        num2===0?`${num1} Small Trucks`:
        `${num1} Small + ${num2} Big = ${totalTruck}`;

    document.getElementById("entryfee").innerText=`${roundUpToTwoDecimalPlaces(num1*SMALL)}+${roundUpToTwoDecimalPlaces(num2*BIG)}=${entry}/-`;

    copyButton.onclick = ()=>copyStatement(num1,num2,num3,revenue,totalTruck);
}

// Fetch + loading
function loadDataForDate(selectedDate){
    const resultTable=document.getElementById("resultTable");
    const noDataCard=document.getElementById("noDataCard");
    const loadingCard=document.getElementById("loadingCard");
    const copyButton=document.getElementById("copyStatementButton");

    loadingCard.style.display="flex";
    noDataCard.style.display="none";
    resultTable.style.display="none";
    copyButton.style.display="none";

    const url=`https://curly-pine-d92f.rokonuzzamanabedin.workers.dev/?date=${selectedDate}`;

    fetch(url)
        .then(r=>r.json())
        .then(response=>{
            loadingCard.style.display="none";

            const d=response.data;
            const exists = response.success && d && 
                (parseInt(d.small_truck)>0 || parseInt(d.big_truck)>0 || parseInt(d.holtage_days)>0);

            if(exists){
                calculateAndDisplayResults(
                    parseInt(d.small_truck)||0,
                    parseInt(d.big_truck)||0,
                    parseInt(d.holtage_days)||0,
                    selectedDate+" 00:00:00"
                );

                resultTable.style.display="table";
                copyButton.style.display="inline-block";
            } else {
                noDataCard.style.display="flex";
            }
        })
        .catch(()=>{
            loadingCard.style.display="none";
            noDataCard.style.display="flex";
        });
}

// Auto load today
window.addEventListener("load", ()=>{
    const t=new Date();
    const d=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;
    loadDataForDate(d);
});
</script>

</body>
</html>
